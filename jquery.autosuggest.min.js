(function(a){a.fn.autosuggest=function(j){var c={url:"/search",method:"get",wrapperClass:"as-wrapper",menuClass:"as-menu",minLength:2,maxNum:10,align:"left",queryParamName:"query",split:null,extra:{},nextStep:null};var b=a.extend({},c,j);a(this).attr("autocomplete","off");a(this).wrap('<div class="'+b.wrapperClass+'"></div>');a('<div class="'+b.menuClass+' list-group"></div>').insertAfter(a(this));var i;var f=a(this);var e=" as-align-left ";if(b.align=="center"){e=" as-align-center"}else{if(b.align=="right"){e=" as-align-right"}}a(this).on("keyup",function(k){var m=k.keyCode;if((m>=37&&m<=40)||m==13){return}var l=a(f).val();if(l==null||l.length==0){return}if(b.split!=null&&l.charAt(l.length-1)==b.split){a(f).next("."+b.menuClass).html("");a(f).next("."+b.menuClass).hide();return}h()});a(this).blur(function(){setTimeout(function(){a(f).next("."+b.menuClass).hide()},200)});function h(){var m=a(f).val();var n=b.queryParamName;if(b.split!=null){var k=m.lastIndexOf(b.split);if(k!=-1){m=m.substring(k+b.split.length)}}var l={};l[n]=m;a.each(b.extra,function(p,o){l[p]=o});if(!m){a(f).next("."+b.menuClass).html("");a(f).next("."+b.menuClass).hide()}if(m.length>=b.minLength){if(i&&i.readyState!=4){i.abort()}i=a.ajax({type:b.method,url:b.url,data:l,dataType:"json",success:function(r){var q="";var o=-1;var p=0;a.each(r,function(u,t){if(b.maxNum>u){q+='<a href="#" class="list-group-item '+e+'" data-id="'+t.id+'" data-label="'+t.label+'">'+t.label+"</a>";p++}});a(f).next("."+b.menuClass).html(q);a(f).next("."+b.menuClass).children().on("click",g);if(a(f).is(":focus")){a(f).next("."+b.menuClass).show()}a(f).unbind("keydown");a(".as-selected").removeClass("as-selected");var s=false;a(f).keydown(function(t){var u=t.keyCode;if(a(f).next().css("display")=="none"&&u!=13){return}if(u==38){a(".as-selected").removeClass("as-selected");o=(o+p-1)%p;a(f).next().children().eq(o).addClass("as-selected");s=true;t.preventDefault();return}if(u==40){a(".as-selected").removeClass("as-selected");o=(o+1)%p;a(f).next().children().eq(o).addClass("as-selected");s=true;return}if(u==13){if(s){a(f).val(d(a(".as-selected").data("label")));a(f).next("."+b.menuClass).hide();s=false}else{if(b.nextStep!=null&&a(f).val().length>0){a(f).next("."+b.menuClass).hide();b.nextStep();i.abort()}}}})}})}}function g(){a(f).val(d(a(this).data("label")));a(f).next("."+b.menuClass).hide();a(f).focus();return false}function d(m){if(b.split==null){return m}var n=a(f).val();var k=m;var l=n.lastIndexOf(b.split);if(l!=-1){k=n.substring(0,l)+b.split+m}return k}return this}}(jQuery));