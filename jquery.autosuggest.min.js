(function(a){a.fn.autosuggest=function(b){var h={url:"/search",method:"get",wrapperClass:"as-wrapper",menuClass:"as-menu",minLength:2,maxNum:10,align:"left",queryParamName:"query",extra:{},nextStep:null};var c=a.extend({},h,b);a(this).attr("autocomplete","off");a(this).wrap('<div class="'+c.wrapperClass+'"></div>');a('<div class="'+c.menuClass+' list-group"></div>').insertAfter(a(this));var i;var e=a(this);var g=" as-align-left ";if(c.align=="center"){g=" as-align-center"}else{if(c.align=="right"){g=" as-align-right"}}a(this).on("keyup",function(j){var k=j.keyCode;if((k>=37&&k<=40)||k==13){return}f()});a(this).blur(function(){setTimeout(function(){a(e).next("."+c.menuClass).hide()},200)});function f(){var k=a(e).val();var l=c.queryParamName;var j={};j[l]=k;a.each(c.extra,function(n,m){j[n]=m});if(!k){a(e).next("."+c.menuClass).html("");a(e).next("."+c.menuClass).hide()}if(k.length>=c.minLength){if(i&&i.readyState!=4){i.abort()}i=a.ajax({type:c.method,url:c.url,data:j,dataType:"json",success:function(p){var o="";var m=-1;var n=0;a.each(p,function(s,r){if(c.maxNum>s){o+='<a href="#" class="list-group-item '+g+'" data-id="'+r.id+'" data-label="'+r.label+'">'+r.label+"</a>";n++}});a(e).next("."+c.menuClass).html(o);a(e).next("."+c.menuClass).children().on("click",d);if(a(e).is(":focus")){a(e).next("."+c.menuClass).show()}a(e).unbind("keydown");a(".as-selected").removeClass("as-selected");var q=false;a(e).keydown(function(r){var s=r.keyCode;if(a(e).next().css("display")=="none"&&s!=13){return}if(s==38){a(".as-selected").removeClass("as-selected");m=(m+n-1)%n;a(e).next().children().eq(m).addClass("as-selected");q=true;r.preventDefault();return}if(s==40){a(".as-selected").removeClass("as-selected");m=(m+1)%n;a(e).next().children().eq(m).addClass("as-selected");q=true;return}if(s==13){if(q){a(e).val(a(".as-selected").data("label"));a(e).next("."+c.menuClass).hide();q=false}else{if(c.nextStep!=null&&a(e).val().length>0){c.nextStep()}}}})}})}}function d(){a(e).val(a(this).data("label"));a(e).next("."+c.menuClass).hide();a(e).focus();return false}return this}}(jQuery));