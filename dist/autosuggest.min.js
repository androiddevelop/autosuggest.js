(function(a){a.fn.autosuggest=function(m){const c={url:"/search",method:"get",wrapperClass:"as-wrapper",menuClass:"as-menu",minLength:2,maxNum:10,align:"left",queryParamName:"query",split:null,highlight:true,extra:{},nextStep:null,open:null,close:null,immediate:false,data:null,firstSelected:false,dataCallback:null,dataType:"json",onSelect:null};const b=a.extend({},c,m);a(this).attr("autocomplete","off");a(this).wrap('<div class="'+b.wrapperClass+'"></div>');a('<div class="'+b.menuClass+' list-group"></div>').insertAfter(a(this));let xhr;const e=a(this);let alignClass=" as-align-left";if(b.align==="center"){alignClass=" as-align-center"}else{if(b.align==="right"){alignClass=" as-align-right"}}a(".as-menu").css("top",a(e).outerHeight());let lastText="";let lock=false;setInterval(f,200);function f(){const n=a(e).val();if(lock||n===lastText){return}lastText=n;if(n==null){i(a(e).next("."+b.menuClass));return}if(n.length<b.minLength){i(a(e).next("."+b.menuClass));return}if(b.split!=null&&n.charAt(n.length-1)===b.split){a(e).next("."+b.menuClass).html("");i(a(e).next("."+b.menuClass))}j()}a(this).blur(function(){setTimeout(function(){i(a(e).next("."+b.menuClass))},200)});function j(){let query=a(e).val();const o=b.queryParamName;query=k(query);const n={};n[o]=query;a.each(b.extra,function(q,p){n[q]=p});if(!query){a(e).next("."+b.menuClass).html("");i(a(e).next("."+b.menuClass))}if(query.length>=b.minLength){if(xhr&&xhr.readyState!==4){xhr.abort()}xhr=a.ajax({type:b.method,url:b.url,data:n,dataType:b.dataType,success:function(p){if(b.dataCallback){p=b.dataCallback(p)}let results="";let selectIndex=-1;let suggestionsNum=0;a.each(p,function(s,r){if(b.maxNum>s){if(b.highlight){const q=k(query);results+='<span href="javascript:void(0)" class="list-group-item '+alignClass+'" data-id="'+r.id+'" data-value="'+r.value+'" data-label="'+r.label+'">'+h(r.value,q)+"</span>"}else{results+='<span href="javascript:void(0)" class="list-group-item '+alignClass+'" data-id="'+r.id+'" data-value="'+r.value+'"  data-label="'+r.label+'">'+r.value+"</span>"}suggestionsNum++}});let ele=a(e).next("."+b.menuClass);ele.html(results);ele.children().on("click",g);if(a(e).is(":focus")){l(a(e).next("."+b.menuClass))}if(suggestionsNum===0&&a(e).next("."+b.menuClass).is(":visible")&&b.close!=null){i(a(e).next("."+b.menuClass))}a(e).unbind("keydown");a(".as-selected").removeClass("as-selected");let upDownOperate=false;if(b.firstSelected){selectIndex=(selectIndex+1)%suggestionsNum;a(e).next("."+b.menuClass).children().eq(selectIndex).addClass("as-selected");if(suggestionsNum>0){upDownOperate=true}}a(e).keydown(function(q){const r=q.keyCode;if(a(e).next("."+b.menuClass).css("display")==="none"&&r!==13){return}if(r===38){a(".as-selected").removeClass("as-selected");selectIndex=(selectIndex+suggestionsNum-1)%suggestionsNum;a(e).next("."+b.menuClass).children().eq(selectIndex).addClass("as-selected");if(suggestionsNum>0){upDownOperate=true}q.preventDefault();return}if(r===40){a(".as-selected").removeClass("as-selected");selectIndex=(selectIndex+1)%suggestionsNum;a(e).next("."+b.menuClass).children().eq(selectIndex).addClass("as-selected");if(suggestionsNum>0){upDownOperate=true}return}if(r===13){if(upDownOperate){lock=true;lastText=d(a(".as-selected").data("value"));a(e).val(lastText);lock=false;i(a(e).next("."+b.menuClass));if(b.immediate&&b.nextStep!=null){b.nextStep(a(".as-selected"))}else{upDownOperate=false}b.onSelect&&b.onSelect(a(".as-selected"))}else{if(b.nextStep!=null&&a(e).val().length>0){i(a(e).next("."+b.menuClass));b.nextStep(a(".as-selected"));xhr.abort()}}}});a(e).next("."+b.menuClass).children().each(function(q){a(this).on("mouseenter",function(){a(".as-selected").removeClass("as-selected");a(this).addClass("as-selected");selectIndex=q})})}})}}function i(n){if(n.is(":visible")){n.hide();if(b.close!=null){b.close()}}}function l(n){if(!n.is(":visible")){n.show();if(b.open!=null){b.open()}}}function g(){lock=true;lastText=d(a(this).data("value"));a(e).val(lastText);lock=false;i(a(e).next("."+b.menuClass));a(e).focus();if(b.immediate&&b.nextStep!=null){b.nextStep(a(".as-selected"))}b.onSelect&&b.onSelect(a(this));return false}function d(o){if(b.split==null){return o}const p=a(e).val();let result=o;const n=p.lastIndexOf(b.split);if(n!==-1){result=p.substring(0,n)+b.split+o}return result}function k(o){if(b.split!=null){const n=o.lastIndexOf(b.split);if(n!==-1){o=o.substring(n+b.split.length)}}return o}function h(q,n){if(q===undefined){return""}if(n===undefined){return q}let searchStartPosition=0;const p=q;let result="";const o=n.length;q=q.toLowerCase();n=n.toLowerCase();let index=q.indexOf(n,searchStartPosition);while(-1!==index){result=result+p.substring(searchStartPosition,index)+"<strong>"+p.substr(index,o)+"</strong>";searchStartPosition=index+o;index=p.indexOf(n,searchStartPosition)}result=result+p.substring(searchStartPosition);return result}return this}}(jQuery));