(function(a){a.fn.autosuggest=function(q){var c={url:"/search",method:"get",wrapperClass:"as-wrapper",menuClass:"as-menu",minLength:2,maxNum:10,align:"left",queryParamName:"query",split:null,highlight:true,extra:{},nextStep:null,open:null,close:null,immediate:false,data:null,firstSelected:false,dataCallback:null,dataType:"json",onSelect:null};var b=a.extend({},c,q);a(this).attr("autocomplete","off");a(this).wrap('<div class="'+b.wrapperClass+'"></div>');a('<div class="'+b.menuClass+' list-group"></div>').insertAfter(a(this));var p;var g=a(this);var e=" as-align-left";if(b.align=="center"){e=" as-align-center"}else{if(b.align=="right"){e=" as-align-right"}}a(".as-menu").css("top",a(g).outerHeight());var k="";var l=false;setInterval(f,200);function f(){var r=a(g).val();if(l||r==k){return}k=r;if(r==null){j(a(g).next("."+b.menuClass));return}if(r.length<b.minLength){j(a(g).next("."+b.menuClass));return}if(b.split!=null&&r.charAt(r.length-1)==b.split){a(g).next("."+b.menuClass).html("");j(a(g).next("."+b.menuClass))}m()}a(this).blur(function(){setTimeout(function(){j(a(g).next("."+b.menuClass))},200)});function m(){var t=a(g).val();var u=b.queryParamName;t=n(t);var r={};r[u]=t;a.each(b.extra,function(x,w){r[x]=w});if(!t){a(g).next("."+b.menuClass).html("");j(a(g).next("."+b.menuClass))}if(t.length>=b.minLength){if(p&&p.readyState!=4){p.abort()}p=a.ajax({type:b.method,url:b.url,data:r,dataType:b.dataType,success:function(y){if(b.dataCallback){y=b.data=b.dataCallback(y)}var x="";var v=-1;var w=0;a.each(y,function(C,B){if(b.maxNum>C){if(b.highlight){var A=n(t);x+='<span href="javascript:void(0)" class="list-group-item '+e+'" data-id="'+B.id+'" data-value="'+B.value+'" data-label="'+B.label+'">'+i(B.value,A)+"</span>"}else{x+='<span href="javascript:void(0)" class="list-group-item '+e+'" data-id="'+B.id+'" data-value="'+B.value+'"  data-label="'+B.label+'">'+B.value+"</span>"}w++}});a(g).next("."+b.menuClass).html(x);a(g).next("."+b.menuClass).children().on("click",h);if(a(g).is(":focus")){o(a(g).next("."+b.menuClass))}if(w==0&&a(g).next("."+b.menuClass).is(":visible")&&b.close!=null){j(a(g).next("."+b.menuClass))}a(g).unbind("keydown");a(".as-selected").removeClass("as-selected");var z=false;if(b.firstSelected){v=(v+1)%w;a(g).next("."+b.menuClass).children().eq(v).addClass("as-selected");z=true}a(g).keydown(function(A){var B=A.keyCode;if(a(g).next("."+b.menuClass).css("display")=="none"&&B!=13){return}if(B==38){a(".as-selected").removeClass("as-selected");v=(v+w-1)%w;a(g).next("."+b.menuClass).children().eq(v).addClass("as-selected");z=true;A.preventDefault();return}if(B==40){a(".as-selected").removeClass("as-selected");v=(v+1)%w;a(g).next("."+b.menuClass).children().eq(v).addClass("as-selected");z=true;return}if(B==13){if(z){l=true;k=d(a(".as-selected").data("value"));a(g).val(k);l=false;j(a(g).next("."+b.menuClass));if(b.immediate&&b.nextStep!=null){b.nextStep(a(".as-selected"))}else{z=false}b.onSelect&&b.onSelect(a(".as-selected"))}else{if(b.nextStep!=null&&a(g).val().length>0){j(a(g).next("."+b.menuClass));b.nextStep(a(".as-selected"));p.abort()}}}});a(g).next("."+b.menuClass).children().each(function(A){a(this).on("mouseenter",function(){a(".as-selected").removeClass("as-selected");a(this).addClass("as-selected");v=A})})}})}}function j(r){if(r.is(":visible")){r.hide();if(b.close!=null){b.close()}}}function o(r){if(!r.is(":visible")){r.show();if(b.open!=null){b.open()}}}function h(){l=true;k=d(a(this).data("value"));a(g).val(k);l=false;j(a(g).next("."+b.menuClass));a(g).focus();if(b.immediate&&b.nextStep!=null){b.nextStep(a(".as-selected"))}b.onSelect&&b.onSelect(a(this));return false}function d(u){if(b.split==null){return u}var v=a(g).val();var r=u;var t=v.lastIndexOf(b.split);if(t!=-1){r=v.substring(0,t)+b.split+u}return r}function n(t){if(b.split!=null){var r=t.lastIndexOf(b.split);if(r!=-1){t=t.substring(r+b.split.length)}}return t}function i(y,t){if(y==undefined){return""}if(t==undefined){return y}var v=0;var x=y;var r="";var w=t.length;y=y.toLowerCase();t=t.toLowerCase();var u=y.indexOf(t,v);while(u!=-1){r=r+x.substring(v,u)+"<strong>"+x.substr(u,w)+"</strong>";v=u+w;u=x.indexOf(t,v)}s;r=r+x.substring(v);return r}return this}}(jQuery));