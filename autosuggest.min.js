(function(a){a.fn.autosuggest=function(q){var c={url:"/search",method:"get",wrapperClass:"as-wrapper",menuClass:"as-menu",minLength:2,maxNum:10,align:"left",queryParamName:"query",split:null,highlight:false,extra:{},nextStep:null,open:null,close:null,immediate:false};var b=a.extend({},c,q);a(this).attr("autocomplete","off");a(this).wrap('<div class="'+b.wrapperClass+'"></div>');a('<div class="'+b.menuClass+' list-group"></div>').insertAfter(a(this));var p;var h=a(this);var e=" as-align-left ";if(b.align=="center"){e=" as-align-center"}else{if(b.align=="right"){e=" as-align-right"}}a(".as-menu").css("top",a(this).outerHeight());var k="";var l=false;setInterval(g,200);function g(){var r=a(h).val();if(l||r==k){return}k=r;if(r==null||r.length==0){o(a(h).next("."+b.menuClass));return}if(r.length<b.minLength){o(a(h).next("."+b.menuClass));return}if(b.split!=null&&r.charAt(r.length-1)==b.split){a(h).next("."+b.menuClass).html("");o(a(h).next("."+b.menuClass))}m()}a(this).blur(function(){setTimeout(function(){o(a(h).next("."+b.menuClass))},200)});function m(){var s=a(h).val();var t=b.queryParamName;s=n(s);var r={};r[t]=s;a.each(b.extra,function(w,u){r[w]=u});if(!s){a(h).next("."+b.menuClass).html("");o(a(h).next("."+b.menuClass))}if(s.length>=b.minLength){if(p&&p.readyState!=4){p.abort()}p=a.ajax({type:b.method,url:b.url,data:r,dataType:"json",success:function(x){var w="";var u=-1;var v=0;a.each(x,function(B,A){if(b.maxNum>B){if(b.highlight){var z=n(s);w+='<span href="#" class="list-group-item '+e+'" data-id="'+A.id+'" data-label="'+A.label+'">'+j(A.label,z)+"</span>"}else{w+='<span href="#" class="list-group-item '+e+'" data-id="'+A.id+'" data-label="'+A.label+'">'+A.label+"</span>"}v++}});a(h).next("."+b.menuClass).html(w);a(h).next("."+b.menuClass).children().on("click",i);if(a(h).is(":focus")){f(a(h).next("."+b.menuClass))}if(v==0&&a(h).next("."+b.menuClass).is(":visible")&&b.close!=null){o(a(h).next("."+b.menuClass))}a(h).unbind("keydown");a(".as-selected").removeClass("as-selected");var y=false;a(h).keydown(function(z){var A=z.keyCode;if(a(h).next("."+b.menuClass).css("display")=="none"&&A!=13){return}if(A==38){a(".as-selected").removeClass("as-selected");u=(u+v-1)%v;a(h).next("."+b.menuClass).children().eq(u).addClass("as-selected");y=true;z.preventDefault();return}if(A==40){a(".as-selected").removeClass("as-selected");u=(u+1)%v;a(h).next("."+b.menuClass).children().eq(u).addClass("as-selected");y=true;return}if(A==13){if(y){l=true;k=d(a(".as-selected").data("label"));a(h).val(k);l=false;o(a(h).next("."+b.menuClass));if(b.immediate&&b.nextStep!=null){b.nextStep()}else{y=false}}else{if(b.nextStep!=null&&a(h).val().length>0){o(a(h).next("."+b.menuClass));b.nextStep();p.abort()}}}});a(h).next("."+b.menuClass).children().each(function(z){a(this).on("mouseenter",function(){a(".as-selected").removeClass("as-selected");a(this).addClass("as-selected");u=z})})}})}}function o(r){if(r.is(":visible")&&b.close!=null){b.close();r.hide()}}function f(r){if(!r.is(":visible")&&b.open!=null){b.open();r.show()}}function i(){l=true;k=d(a(this).data("label"));a(h).val(k);l=false;o(a(h).next("."+b.menuClass));a(h).focus();if(b.immediate&&b.nextStep!=null){b.nextStep()}return false}function d(t){if(b.split==null){return t}var u=a(h).val();var r=t;var s=u.lastIndexOf(b.split);if(s!=-1){r=u.substring(0,s)+b.split+t}return r}function n(s){if(b.split!=null){var r=s.lastIndexOf(b.split);if(r!=-1){s=s.substring(r+b.split.length)}}return s}function j(x,s){var u=0;var w=x;var r="";var v=s.length;x=x.toLowerCase();s=s.toLowerCase();var t=x.indexOf(s,u);while(t!=-1){r=r+w.substring(u,t)+"<strong>"+w.substr(t,v)+"</strong>";u=t+v;t=w.indexOf(s,u)}r=r+w.substring(u);return r}return this}}(jQuery));