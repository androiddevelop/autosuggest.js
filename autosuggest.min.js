!function(C){C.fn.autosuggest=function(e){var u,t,r=C.extend({},{url:"/search",method:"get",wrapperClass:"as-wrapper",menuClass:"as-menu",menuClassStyle:{"overflow-y":"auto",height:"150px"},minLength:1,maxNum:10,align:"left",queryParamName:"query",split:null,highlight:!0,extra:{},nextStep:null,open:null,close:null,immediate:!1,data:null,firstSelected:!1,dataCallback:null,dataType:"json",onSelect:null,selectAdd:!1},e),d=(C(this).attr("autocomplete","off"),C(this).wrap('<div class="'+r.wrapperClass+'"></div>'),C('<div class="'+r.menuClass+' list-group"></div>').insertAfter(C(this)),C(this)),c=" as-align-left";for(t in"center"==r.align?c=" as-align-center":"right"==r.align&&(c=" as-align-right"),C(".as-menu").css("top",C(d).outerHeight()),r.menuClassStyle)C(".as-menu").css(t,r.menuClassStyle[t]);var o="",m=!1;function s(){var i=C(d).val(),e=r.queryParamName,i=p(i),s={};s[e]=i,C.each(r.extra,function(e,t){s[e]=t}),i||(C(d).next("."+r.menuClass).html(""),h(C(d).next("."+r.menuClass))),i.length>=r.minLength&&(u&&4!=u.readyState&&u.abort(),u=C.ajax({type:r.method,url:r.url,data:s,dataType:r.dataType,success:function(e){r.dataCallback&&(e=r.data=r.dataCallback(e));var s="",l=-1,a=0,n=(C.each(e,function(e,t){r.maxNum>e&&(r.highlight?(e=p(i),s+='<span href="javascript:void(0)" class="list-group-item '+c+'" data-id="'+t.id+'" data-value="'+t.value+'" data-label="'+t.label+'">'+function(e,t){if(e==undefined)return"";if(t==undefined||""==t)return e;var s=0,l=e,a="",n=t.length,i=(e=e.toLowerCase(),t=t.toLowerCase(),e.indexOf(t,s));for(;-1!=i;)a=a+l.substring(s,i)+"<strong>"+l.substr(i,n)+"</strong>",s=i+n,i=l.indexOf(t,s);return a+=l.substring(s)}(t.value,e)+"</span>"):s+='<span href="javascript:void(0)" class="list-group-item '+c+'" data-id="'+t.id+'" data-value="'+t.value+'"  data-label="'+t.label+'">'+t.value+"</span>",a++)}),C(d).next("."+r.menuClass).html(s),C(d).next("."+r.menuClass).children().on("click",v),!C(d).is(":focus")||(e=C(d).next("."+r.menuClass)).is(":visible")||(e.show(),null!=r.open&&r.open()),0==a&&C(d).next("."+r.menuClass).is(":visible")&&null!=r.close&&h(C(d).next("."+r.menuClass)),C(d).unbind("keydown"),C(".as-selected").removeClass("as-selected"),!1);r.firstSelected&&(l=(l+1)%a,C(d).next("."+r.menuClass).children().eq(l).addClass("as-selected"),0<a&&(n=!0)),C(d).keydown(function(e){var t=e.keyCode;if("none"!=C(d).next("."+r.menuClass).css("display")||13==t)return 38==t?(C(".as-selected").removeClass("as-selected"),l=(l+a-1)%a,C(d).next("."+r.menuClass).children().eq(l).addClass("as-selected"),0<a&&(n=!0),void e.preventDefault()):40==t?(C(".as-selected").removeClass("as-selected"),l=(l+1)%a,C(d).next("."+r.menuClass).children().eq(l).addClass("as-selected"),void(0<a&&(n=!0))):void(13==t&&(n?(m=!0,o=f(C(".as-selected").data("value")),r.selectAdd?C(d).val(C(d).val()+o):C(d).val(o),m=!1,h(C(d).next("."+r.menuClass)),r.immediate&&null!=r.nextStep?r.nextStep(C(".as-selected")):n=!1,r.onSelect&&r.onSelect(C(".as-selected"))):null!=r.nextStep&&0<C(d).val().length&&(h(C(d).next("."+r.menuClass)),r.nextStep(C(".as-selected")),u.abort())))}),C(d).next("."+r.menuClass).children().each(function(e){C(this).on("mouseenter",function(){C(".as-selected").removeClass("as-selected"),C(this).addClass("as-selected"),l=e})})}}))}function h(e){e.is(":visible")&&(e.hide(),null!=r.close&&r.close())}function v(){return m=!0,o=f(C(this).data("value")),r.selectAdd?C(d).val(C(d).val()+o):C(d).val(o),m=!1,h(C(d).next("."+r.menuClass)),C(d).focus(),r.immediate&&null!=r.nextStep&&r.nextStep(C(".as-selected")),r.onSelect&&r.onSelect(C(this)),!1}function f(e){if(null==r.split)return e;var t=C(d).val(),s=e,l=t.lastIndexOf(r.split);return s=-1!=l?t.substring(0,l)+r.split+e:s}function p(e){var t;return e=null!=r.split&&-1!=(t=e.lastIndexOf(r.split))?e.substring(t+r.split.length):e}return setInterval(function(){var e=C(d).val();m||e==o||(null==(o=e)&&0!=r.minLength||e.length<r.minLength?h(C(d).next("."+r.menuClass)):(null!=r.split&&e.charAt(e.length-1)==r.split&&(C(d).next("."+r.menuClass).html(""),h(C(d).next("."+r.menuClass))),s()))},200),r.dbClick&&C(this).dblclick(function(){s()}),C(this).blur(function(){setTimeout(function(){h(C(d).next("."+r.menuClass))},200)}),this}}(jQuery);