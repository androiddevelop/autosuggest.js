(function(a){a.fn.autosuggest=function(n){var c={url:"/search",method:"get",wrapperClass:"as-wrapper",menuClass:"as-menu",minLength:2,maxNum:10,align:"left",queryParamName:"query",split:null,highlight:false,extra:{},nextStep:null,open:null,close:null};var b=a.extend({},c,n);a(this).attr("autocomplete","off");a(this).wrap('<div class="'+b.wrapperClass+'"></div>');a('<div class="'+b.menuClass+' list-group"></div>').insertAfter(a(this));var l;var g=a(this);var e=" as-align-left ";if(b.align=="center"){e=" as-align-center"}else{if(b.align=="right"){e=" as-align-right"}}a(".as-menu").css("top",a(this).outerHeight());a(this).on("keyup",function(o){var q=o.keyCode;if((q>=37&&q<=40)||q==13){return}var p=a(g).val();if(p==null||p.length==0){m(a(g).next("."+b.menuClass));return}if(p.length<b.minLength){m(a(g).next("."+b.menuClass))}if(b.split!=null&&p.charAt(p.length-1)==b.split){a(g).next("."+b.menuClass).html("");m(a(g).next("."+b.menuClass));return}j()});a(this).blur(function(){setTimeout(function(){m(a(g).next("."+b.menuClass))},200)});function j(){var p=a(g).val();var q=b.queryParamName;p=k(p);var o={};o[q]=p;a.each(b.extra,function(s,r){o[s]=r});if(!p){a(g).next("."+b.menuClass).html("");m(a(g).next("."+b.menuClass))}if(p.length>=b.minLength){if(l&&l.readyState!=4){l.abort()}l=a.ajax({type:b.method,url:b.url,data:o,dataType:"json",success:function(u){var t="";var r=-1;var s=0;a.each(u,function(y,x){if(b.maxNum>y){if(b.highlight){var w=k(p);t+='<span href="#" class="list-group-item '+e+'" data-id="'+x.id+'" data-label="'+x.label+'">'+i(x.label,w)+"</span>"}else{t+='<span href="#" class="list-group-item '+e+'" data-id="'+x.id+'" data-label="'+x.label+'">'+x.label+"</span>"}s++}});a(g).next("."+b.menuClass).html(t);a(g).next("."+b.menuClass).children().on("click",h);if(a(g).is(":focus")){f(a(g).next("."+b.menuClass))}a(g).unbind("keydown");a(".as-selected").removeClass("as-selected");var v=false;a(g).keydown(function(w){var x=w.keyCode;if(a(g).next("."+b.menuClass).css("display")=="none"&&x!=13){return}if(x==38){a(".as-selected").removeClass("as-selected");r=(r+s-1)%s;a(g).next("."+b.menuClass).children().eq(r).addClass("as-selected");v=true;w.preventDefault();return}if(x==40){a(".as-selected").removeClass("as-selected");r=(r+1)%s;a(g).next("."+b.menuClass).children().eq(r).addClass("as-selected");v=true;return}if(x==13){if(v){a(g).val(d(a(".as-selected").data("label")));m(a(g).next("."+b.menuClass));v=false}else{if(b.nextStep!=null&&a(g).val().length>0){m(a(g).next("."+b.menuClass));b.nextStep();l.abort()}}}});a(g).next("."+b.menuClass).children().each(function(w){a(this).on("mouseenter",function(){a(".as-selected").removeClass("as-selected");a(this).addClass("as-selected");r=w})})}})}}function m(o){if(o.is(":visible")&&b.close!=null){b.close()}o.hide()}function f(o){if(!o.is(":visible")&&b.open!=null){b.open()}o.show()}function h(){a(g).val(d(a(this).data("label")));m(a(g).next("."+b.menuClass));a(g).focus();return false}function d(q){if(b.split==null){return q}var r=a(g).val();var o=q;var p=r.lastIndexOf(b.split);if(p!=-1){o=r.substring(0,p)+b.split+q}return o}function k(p){if(b.split!=null){var o=p.lastIndexOf(b.split);if(o!=-1){p=p.substring(o+b.split.length)}}return p}function i(u,p){var r=0;var t=u;var o="";var s=p.length;u=u.toLowerCase();p=p.toLowerCase();var q=u.indexOf(p,r);while(q!=-1){o=o+t.substring(r,q)+"<strong>"+t.substr(q,s)+"</strong>";r=q+s;q=t.indexOf(p,r)}o=o+t.substring(r);return o}return this}}(jQuery));