(function(a){a.fn.autosuggest=function(q){var c={url:"/search",method:"get",wrapperClass:"as-wrapper",menuClass:"as-menu",minLength:2,maxNum:10,align:"left",queryParamName:"query",split:null,highlight:true,extra:{},nextStep:null,open:null,close:null,immediate:false,data:null,firstSelected:false,dataCallback:null,dataType:"json",onSelect:null};var b=a.extend({},c,q);a(this).attr("autocomplete","off");a(this).wrap('<div class="'+b.wrapperClass+'"></div>');a('<div class="'+b.menuClass+' list-group"></div>').insertAfter(a(this));var p;var g=a(this);var e=" as-align-left";if(b.align=="center"){e=" as-align-center"}else{if(b.align=="right"){e=" as-align-right"}}a(".as-menu").css("top",a(g).outerHeight());var k="";var l=false;setInterval(f,200);function f(){var r=a(g).val();if(l||r==k){return}k=r;if(r==null){j(a(g).next("."+b.menuClass));return}if(r.length<b.minLength){j(a(g).next("."+b.menuClass));return}if(b.split!=null&&r.charAt(r.length-1)==b.split){a(g).next("."+b.menuClass).html("");j(a(g).next("."+b.menuClass))}m()}a(this).blur(function(){setTimeout(function(){j(a(g).next("."+b.menuClass))},200)});function m(){var s=a(g).val();var t=b.queryParamName;s=n(s);var r={};r[t]=s;a.each(b.extra,function(w,u){r[w]=u});if(!s){a(g).next("."+b.menuClass).html("");j(a(g).next("."+b.menuClass))}if(s.length>=b.minLength){if(p&&p.readyState!=4){p.abort()}p=a.ajax({type:b.method,url:b.url,data:r,dataType:b.dataType,success:function(x){if(b.dataCallback){x=b.data=b.dataCallback(x)}var w="";var u=-1;var v=0;a.each(x,function(B,A){if(b.maxNum>B){if(b.highlight){var z=n(s);w+='<span href="javascript:void(0)" class="list-group-item '+e+'" data-id="'+A.id+'" data-value="'+A.value+'" data-label="'+A.label+'">'+i(A.value,z)+"</span>"}else{w+='<span href="javascript:void(0)" class="list-group-item '+e+'" data-id="'+A.id+'" data-value="'+A.value+'"  data-label="'+A.label+'">'+A.value+"</span>"}v++}});a(g).next("."+b.menuClass).html(w);a(g).next("."+b.menuClass).children().on("click",h);if(a(g).is(":focus")){o(a(g).next("."+b.menuClass))}if(v==0&&a(g).next("."+b.menuClass).is(":visible")&&b.close!=null){j(a(g).next("."+b.menuClass))}a(g).unbind("keydown");a(".as-selected").removeClass("as-selected");var y=false;if(b.firstSelected){u=(u+1)%v;a(g).next("."+b.menuClass).children().eq(u).addClass("as-selected");y=true}a(g).keydown(function(z){var A=z.keyCode;if(a(g).next("."+b.menuClass).css("display")=="none"&&A!=13){return}if(A==38){a(".as-selected").removeClass("as-selected");u=(u+v-1)%v;a(g).next("."+b.menuClass).children().eq(u).addClass("as-selected");y=true;z.preventDefault();return}if(A==40){a(".as-selected").removeClass("as-selected");u=(u+1)%v;a(g).next("."+b.menuClass).children().eq(u).addClass("as-selected");y=true;return}if(A==13){if(y){l=true;k=d(a(".as-selected").data("value"));a(g).val(k);l=false;j(a(g).next("."+b.menuClass));if(b.immediate&&b.nextStep!=null){b.nextStep(a(".as-selected"))}else{y=false}b.onSelect&&b.onSelect(a(".as-selected"))}else{if(b.nextStep!=null&&a(g).val().length>0){j(a(g).next("."+b.menuClass));b.nextStep(a(".as-selected"));p.abort()}}}});a(g).next("."+b.menuClass).children().each(function(z){a(this).on("mouseenter",function(){a(".as-selected").removeClass("as-selected");a(this).addClass("as-selected");u=z})})}})}}function j(r){if(r.is(":visible")){r.hide();if(b.close!=null){b.close()}}}function o(r){if(!r.is(":visible")){r.show();if(b.open!=null){b.open()}}}function h(){l=true;k=d(a(this).data("value"));a(g).val(k);l=false;j(a(g).next("."+b.menuClass));a(g).focus();if(b.immediate&&b.nextStep!=null){b.nextStep(a(".as-selected"))}b.onSelect&&b.onSelect(a(this));return false}function d(t){if(b.split==null){return t}var u=a(g).val();var r=t;var s=u.lastIndexOf(b.split);if(s!=-1){r=u.substring(0,s)+b.split+t}return r}function n(s){if(b.split!=null){var r=s.lastIndexOf(b.split);if(r!=-1){s=s.substring(r+b.split.length)}}return s}function i(x,s){if(x==undefined){return""}if(s==undefined){return x}var u=0;var w=x;var r="";var v=s.length;x=x.toLowerCase();s=s.toLowerCase();var t=x.indexOf(s,u);while(t!=-1){r=r+w.substring(u,t)+"<strong>"+w.substr(t,v)+"</strong>";u=t+v;t=w.indexOf(s,u)}r=r+w.substring(u);return r}return this}}(jQuery));