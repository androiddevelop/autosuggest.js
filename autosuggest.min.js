(function(a){a.fn.autosuggest=function(l){var c={url:"/search",method:"get",wrapperClass:"as-wrapper",menuClass:"as-menu",minLength:2,maxNum:10,align:"left",queryParamName:"query",split:null,highlight:false,extra:{},nextStep:null};var b=a.extend({},c,l);a(this).attr("autocomplete","off");a(this).wrap('<div class="'+b.wrapperClass+'"></div>');a('<div class="'+b.menuClass+' list-group"></div>').insertAfter(a(this));var k;var f=a(this);var e=" as-align-left ";if(b.align=="center"){e=" as-align-center"}else{if(b.align=="right"){e=" as-align-right"}}a(this).on("keyup",function(m){var o=m.keyCode;if((o>=37&&o<=40)||o==13){return}var n=a(f).val();if(n==null||n.length==0){return}if(b.split!=null&&n.charAt(n.length-1)==b.split){a(f).next("."+b.menuClass).html("");a(f).next("."+b.menuClass).hide();return}i()});a(this).blur(function(){setTimeout(function(){a(f).next("."+b.menuClass).hide()},200)});function i(){var n=a(f).val();var o=b.queryParamName;n=j(n);var m={};m[o]=n;a.each(b.extra,function(q,p){m[q]=p});if(!n){a(f).next("."+b.menuClass).html("");a(f).next("."+b.menuClass).hide()}if(n.length>=b.minLength){if(k&&k.readyState!=4){k.abort()}k=a.ajax({type:b.method,url:b.url,data:m,dataType:"json",success:function(s){var r="";var p=-1;var q=0;a.each(s,function(w,v){if(b.maxNum>w){if(b.highlight){var u=j(n);r+='<span href="#" class="list-group-item '+e+'" data-id="'+v.id+'" data-label="'+v.label+'">'+h(v.label,u)+"</span>"}else{r+='<span href="#" class="list-group-item '+e+'" data-id="'+v.id+'" data-label="'+v.label+'">'+v.label+"</span>"}q++}});a(f).next("."+b.menuClass).html(r);a(f).next("."+b.menuClass).children().on("click",g);if(a(f).is(":focus")){a(f).next("."+b.menuClass).show()}a(f).unbind("keydown");a(".as-selected").removeClass("as-selected");var t=false;a(f).keydown(function(u){var v=u.keyCode;if(a(f).next("."+b.menuClass).css("display")=="none"&&v!=13){return}if(v==38){a(".as-selected").removeClass("as-selected");p=(p+q-1)%q;a(f).next("."+b.menuClass).children().eq(p).addClass("as-selected");t=true;u.preventDefault();return}if(v==40){a(".as-selected").removeClass("as-selected");p=(p+1)%q;a(f).next("."+b.menuClass).children().eq(p).addClass("as-selected");t=true;return}if(v==13){if(t){a(f).val(d(a(".as-selected").data("label")));a(f).next("."+b.menuClass).hide();t=false}else{if(b.nextStep!=null&&a(f).val().length>0){a(f).next("."+b.menuClass).hide();b.nextStep();k.abort()}}}});a(f).next("."+b.menuClass).children().each(function(u){a(this).on("mouseenter",function(){a(".as-selected").removeClass("as-selected");a(this).addClass("as-selected");p=u})})}})}}function g(){a(f).val(d(a(this).data("label")));a(f).next("."+b.menuClass).hide();a(f).focus();return false}function d(o){if(b.split==null){return o}var p=a(f).val();var m=o;var n=p.lastIndexOf(b.split);if(n!=-1){m=p.substring(0,n)+b.split+o}return m}function j(n){if(b.split!=null){var m=n.lastIndexOf(b.split);if(m!=-1){n=n.substring(m+b.split.length)}}return n}function h(s,n){var p=0;var r=s;var m="";var q=n.length;s=s.toLowerCase();n=n.toLowerCase();var o=s.indexOf(n,p);while(o!=-1){m=m+r.substring(p,o)+"<strong>"+r.substr(o,q)+"</strong>";p=o+q;o=r.indexOf(n,p)}m=m+r.substring(p);return m}return this}}(jQuery));